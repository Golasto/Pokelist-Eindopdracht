{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Matteus\\\\Desktop\\\\School codes\\\\React\\\\Huiswerk\\\\pokelist\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport { createContext, useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport jwt_decode from \"jwt-decode\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext({});\nfunction AuthContextProvider(_ref, props) {\n  _s();\n  let {\n    children\n  } = _ref;\n  const [auth, setAuth] = useState({\n    isAuth: false,\n    user: null,\n    status: \"pending\"\n  });\n  const navigate = useNavigate();\n  useEffect(() => {\n    const storedToken = localStorage.getItem('token');\n    if (storedToken) {\n      const decodedToken = jwt_decode(storedToken);\n      if (Math.floor(Date.now() / 1000) < decodedToken.exp) {\n        console.log(\"De gebruiker is NOG STEEDS ingelogd\");\n        void fetchUserData(storedToken, decodedToken.sub);\n      } else {\n        console.log(\"De token is verlopen\");\n        localStorage.removeItem('token');\n      }\n    } else {\n      setAuth({\n        ...auth,\n        isAuth: false,\n        user: null,\n        status: \"done\"\n      });\n    }\n  }, [auth, fetchUserData]);\n  function login(jwt) {\n    console.log(\"Gebruiker is ingelogd!\");\n    localStorage.setItem('token', jwt);\n    const decodedToken = jwt_decode(jwt);\n    void fetchUserData(jwt, decodedToken.sub, \"/\");\n  }\n  async function fetchUserData(jwt, id, redirect) {\n    try {\n      const response = await axios.get(`https://frontend-educational-backend.herokuapp.com/api/user`, {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${jwt}`\n        }\n      });\n      setAuth({\n        ...auth,\n        isAuth: true,\n        user: {\n          email: response.data.email,\n          id: response.data.id,\n          username: response.data.username\n        },\n        status: \"done\"\n      });\n      if (redirect) {\n        navigate(redirect);\n      }\n    } catch (e) {\n      console.error(e);\n      setAuth({\n        ...auth,\n        status: \"done\"\n      });\n    }\n  }\n  function logout() {\n    console.log(\" Gebruiker is uitgelogd\");\n    localStorage.removeItem('token');\n    setAuth({\n      ...auth,\n      isAuth: false,\n      user: null,\n      status: \"done\"\n    });\n    navigate(\"/\");\n  }\n  const contextData = {\n    isAuth: auth,\n    login: login,\n    logout: logout\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextData,\n    children: auth.status === \"done\" ? children : /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 51\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 9\n  }, this);\n}\n_s(AuthContextProvider, \"AIp+vBY1Jz5IFKWa8rXA6kBAIWQ=\", false, function () {\n  return [useNavigate];\n});\n_c = AuthContextProvider;\nexport default AuthContextProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthContextProvider\");","map":{"version":3,"names":["createContext","useEffect","useState","useNavigate","jwt_decode","axios","AuthContext","AuthContextProvider","props","children","auth","setAuth","isAuth","user","status","navigate","storedToken","localStorage","getItem","decodedToken","Math","floor","Date","now","exp","console","log","fetchUserData","sub","removeItem","login","jwt","setItem","id","redirect","response","get","headers","Authorization","email","data","username","e","error","logout","contextData"],"sources":["C:/Users/Matteus/Desktop/School codes/React/Huiswerk/pokelist/src/context/AuthContext.js"],"sourcesContent":["import { createContext, useEffect, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport axios from \"axios\";\r\n\r\nexport const AuthContext = createContext({} );\r\n\r\nfunction AuthContextProvider( { children }, props ) {\r\n\r\n    const [auth, setAuth] = useState({\r\n        isAuth: false,\r\n        user: null,\r\n        status: \"pending\"\r\n    });\r\n    const navigate = useNavigate()\r\n\r\n    useEffect(() => {\r\n        const storedToken = localStorage.getItem('token')\r\n\r\n        if (storedToken) {\r\n            const decodedToken = jwt_decode(storedToken)\r\n\r\n            if (Math.floor(Date.now() / 1000) < decodedToken.exp) {\r\n                console.log(\"De gebruiker is NOG STEEDS ingelogd\")\r\n                void fetchUserData(storedToken, decodedToken.sub)\r\n            } else {\r\n                console.log(\"De token is verlopen\")\r\n                localStorage.removeItem('token')\r\n            }\r\n        } else {\r\n            setAuth({\r\n                ...auth,\r\n                isAuth: false,\r\n                user: null,\r\n                status: \"done\"\r\n            })\r\n        }\r\n    }, [auth, fetchUserData])\r\n\r\n    function login(jwt) {\r\n        console.log(\"Gebruiker is ingelogd!\")\r\n        localStorage.setItem('token', jwt)\r\n        const decodedToken = jwt_decode(jwt);\r\n\r\n        void fetchUserData(jwt, decodedToken.sub, \"/\")\r\n    }\r\n\r\n    async function fetchUserData(jwt, id, redirect) {\r\n        try {\r\n            const response = await axios.get(`https://frontend-educational-backend.herokuapp.com/api/user`, {\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    Authorization: `Bearer ${jwt}`,\r\n                }\r\n            })\r\n            setAuth({\r\n                ...auth,\r\n                isAuth: true,\r\n                user: {\r\n                    email: response.data.email,\r\n                    id: response.data.id,\r\n                    username: response.data.username\r\n                },\r\n                status: \"done\"\r\n            })\r\n            if (redirect) {\r\n                navigate(redirect)\r\n            }\r\n        } catch (e) {\r\n            console.error(e)\r\n            setAuth({\r\n                ...auth,\r\n                status: \"done\"\r\n            })\r\n        }\r\n    }\r\n    function logout() {\r\n        console.log( \" Gebruiker is uitgelogd\" )\r\n        localStorage.removeItem( 'token' )\r\n        setAuth( {\r\n            ...auth,\r\n            isAuth: false,\r\n            user: null,\r\n            status: \"done\"\r\n        } )\r\n        navigate( \"/\" )\r\n    }\r\n\r\n    const contextData = {\r\n        isAuth: auth,\r\n        login: login,\r\n        logout: logout\r\n    }\r\n\r\n    return (\r\n        <AuthContext.Provider value={ contextData }>\r\n            { auth.status === \"done\" ? children : <p>Loading...</p> }\r\n        </AuthContext.Provider>\r\n    )\r\n}\r\n\r\nexport default AuthContextProvider;"],"mappings":"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"},"metadata":{},"sourceType":"module"}